<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>AsiaX Pro • Referral Network</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.13.4/ethers.umd.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    body {
      background: linear-gradient(135deg, #0f001a 0%, #05000f 100%);
      color: #e0e0ff;
      font-family: 'Inter', system-ui, sans-serif;
      min-height: 100vh;
      overflow-x: hidden;
    }
    .glass {
      background: rgba(30, 20, 60, 0.4);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(100, 100, 255, 0.15);
      border-radius: 1.5rem;
    }
    .neon-border {
      box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
      transition: all 0.4s ease;
    }
    .neon-border:hover {
      box-shadow: 0 0 25px rgba(0, 255, 255, 0.4);
    }
    .status-circle {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      transition: transform 0.5s ease, box-shadow 0.5s ease;
      background: rgba(20, 20, 40, 0.6);
      border: 2px solid #333366;
    }
    .active {
      transform: scale(1.1);
      box-shadow: 0 0 30px rgba(0, 255, 180, 0.5);
      border-color: #00ffb3;
      background: linear-gradient(135deg, rgba(0, 255, 180, 0.15), rgba(0, 180, 255, 0.1));
    }
    .connect-btn {
      background: linear-gradient(90deg, #00d4ff, #7b00ff);
      box-shadow: 0 8px 25px rgba(0, 212, 255, 0.4);
      transition: all 0.3s ease;
    }
    .connect-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 35px rgba(123, 0, 255, 0.6);
    }
    .tree-line {
      height: 2px;
      background: linear-gradient(to right, transparent, #00d4ff, #7b00ff, transparent);
      opacity: 0.6;
    }
  </style>
</head>
<body class="antialiased">

<div class="max-w-lg mx-auto px-5 py-8">

  <div class="flex flex-col sm:flex-row justify-between items-center gap-6 mb-12">
    <div class="text-3xl font-bold tracking-tight bg-gradient-to-r from-cyan-400 to-purple-500 bg-clip-text text-transparent">
      ASIAXPRO
    </div>
    <button id="connectBtn" class="connect-btn text-black font-semibold px-6 py-2.5 rounded-full flex items-center gap-2 shadow-lg neon-border" onclick="connectWallet()">
      <i class="fa-solid fa-wallet"></i>
      <span>Connect Wallet</span>
    </button>
  </div>

  <h1 class="text-4xl font-extrabold text-center mb-10 bg-gradient-to-r from-purple-400 via-cyan-400 to-blue-400 bg-clip-text text-transparent">
    CRYPTO QUIZ
  </h1>

  <div class="glass p-4 mb-10 neon-border text-center max-w-xs mx-auto">
    <div class="text-[10px] text-gray-400 mb-1 uppercase tracking-widest">MY WALLET ADDRESS</div>
    <div id="userAddr" class="font-mono text-sm break-all text-white font-medium">
      Not Connected
    </div>
    <button onclick="copyAddress()" class="mt-3 text-cyan-400 hover:text-cyan-300 transition flex items-center justify-center mx-auto gap-2 text-xs">
      <i class="fa-solid fa-copy"></i> Copy Address
    </button>
  </div>

  <button onclick="window.location.href='/'" class="glass text-white text-sm font-medium py-3 px-8 rounded-xl mx-auto block mb-12 neon-border hover:bg-white/5 transition">
    ← Back to Home
  </button>

  <div class="relative text-center mb-16">
    <div id="userCircle" class="status-circle mx-auto neon-border">
      <i class="fa-solid fa-user-shield text-gray-500"></i>
    </div>
    <div class="absolute top-[45%] left-[30%] w-[40%] tree-line transform -rotate-30"></div>
    <div class="absolute top-[45%] right-[30%] w-[40%] tree-line transform rotate-30"></div>
    <div class="flex justify-center gap-12 sm:gap-20 mt-16">
      <div id="ref1Circle" class="status-circle neon-border">
        <i class="fa-solid fa-user-plus text-gray-500"></i>
      </div>
      <div id="ref2Circle" class="status-circle neon-border">
        <i class="fa-solid fa-user-plus text-gray-500"></i>
      </div>
    </div>
  </div>

  <div class="text-center text-xs text-gray-500">
    Play the quiz and earn unlimited Alisa Coins
  </div>

</div>

<script>
  const CONTRACT_ADDRESS = "0xF6d0d72AAf0Bbf5C459E680f1e6E75E3B1ce1f06";
  const ABI = [
    "function userBasic(address) view returns (address referrer, uint256 totalInvestment, uint256 firstInvestmentTime, uint256 lastROICalculation, uint256 totalWithdrawn, uint256 sponsorIncome, uint256 generationIncome, uint256 totalROIWithdrawn, uint256 totalPoolIncomeWithdrawn, uint256 totalSponsorWithdrawn, uint256 totalGenerationWithdrawn)",
    "function userNetwork(address) view returns (uint256 totalTeam, uint256 activeDirects, bool silverPoolMember, bool goldPoolMember, bool platinumPoolMember, uint256 silverPoolJoinTime, uint256 goldPoolJoinTime, uint256 platinumPoolJoinTime)"
  ];

  let provider, signer, contract;

  async function connectWallet() {
    if (!window.ethereum) return alert("Please install MetaMask!");
    try {
      provider = new ethers.BrowserProvider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = await provider.getSigner();
      const addr = await signer.getAddress();
      contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);

      // Fixed Button Text Logic
      const shortAddr = addr.substring(0, 6) + "..." + addr.substring(addr.length - 4);
      document.getElementById("connectBtn").innerHTML = `<i class="fa-solid fa-wallet"></i> ${shortAddr}`;
      document.getElementById("userAddr").textContent = addr;

      loadData(addr);
    } catch (err) {
      console.error(err);
      alert("Connection failed");
    }
  }

  async function loadData(addr) {
    try {
      const [basic, network] = await Promise.all([
        contract.userBasic(addr),
        contract.userNetwork(addr)
      ]);
      const invested = Number(basic.totalInvestment) > 0;
      const directs = Number(network.activeDirects);

      document.getElementById("userCircle").classList.toggle("active", invested);
      document.getElementById("userCircle").innerHTML = invested ? '<i class="fa-solid fa-check text-cyan-300"></i>' : '<i class="fa-solid fa-user-shield text-gray-500"></i>';

      const r1 = document.getElementById("ref1Circle");
      r1.classList.toggle("active", directs >= 1);
      r1.innerHTML = directs >= 1 ? '<i class="fa-solid fa-check text-cyan-300"></i>' : '<i class="fa-solid fa-user-plus text-gray-500"></i>';

      const r2 = document.getElementById("ref2Circle");
      r2.classList.toggle("active", directs >= 2);
      r2.innerHTML = directs >= 2 ? '<i class="fa-solid fa-check text-cyan-300"></i>' : '<i class="fa-solid fa-user-plus text-gray-500"></i>';
    } catch (err) {
      console.error("Data Load Error:", err);
    }
  }

  function copyAddress() {
    const addr = document.getElementById("userAddr").textContent;
    if (addr.includes("Not Connected")) return alert("Connect wallet first!");
    navigator.clipboard.writeText(addr.trim());
    alert("Address copied!");
  }

  if (window.ethereum) {
    window.ethereum.on("accountsChanged", () => location.reload());
  }
</script>
</body>
</html>
